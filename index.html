<html>
    <head>
        <link rel="stylesheet" href="ui.css">
        <title>Pixel Renderer</title>
        <style>
            body {margin: 0;}
            canvas {width: 100%; height: 100%};
            #header{background-color: #2E2E2E; width: 100%; height: 100%}
        </style>
    </head>

    <body>
        <div id="main" class="parent">

            <div id="header" class="header">
                <p class="header-logo">Pixel Renderer</p>
                <input type="file" name="loader" id="loader" class="header-content"onchange="changeCubeColor()"/>
            </div>
            
            <div id="selector" class="selector">
                <div id="info">
                    <button type="button" onclick="createButton()" class="add-character-btn">+ Add New Animation</button>
                    <div id="bt-list" >
                    <script src="three/three.js"></script>
                    <script>
                        var buttons = []
                        bt_list = document.getElementById("bt-list");
                        var selected_button = null;
                        function changeDivColor(index)
                        {
                            console.log(index);
                            btn = document.getElementById("btn_el_"+index);

                            if(selected_button != null)
                                selected_button.className = "button-default";

                            selected_button = btn;
                            selected_button.className = "button-selected";

                        }
                        function finishname(btn_idx)
                        {
                            btn = document.getElementById("btn_el_"+btn_idx);

                        }
                        
                        //TODO: Use div instead of button and make it behave like one
                        //TODO: Make changing name available only after creating the button
                        //      and after double clicking it
                        function createButton()
                        {
                            buttons.push("Oie");
                            var i = buttons.length - 1;

                            var btn = document.createElement("div");
                            btn.id = "btn_el_" + i.toString();
                            //btn.className = "button-default";
                            btn.setAttribute( "onclick", "changeDivColor("+i+")" );
                            //btn.onclick = changeCubeColor;

                            var t = document.createTextNode(buttons[i]);
                            var txt = document.createElement("input");
                            txt.setAttribute("type", "text");
                            txt.setAttribute("value", "New Anim");
                            txt.className = "button-default";
                            txt.readOnly = true;
                            txt.ondblclick = function(){txt.readOnly = false;}
                            txt.onclick = function(){txt.className = "button-selected"}
                            txt.onkeypress = function(e){
                                if (!e) e = window.event;
                                var keyCode = e.keyCode || e.which;
                                if (keyCode == '13'){
                                    txt.readOnly = true;
                                    return;
                                }
                            }

                            btn.appendChild(txt);

                            bt_list.appendChild(btn);
                        }
                    </script>
                    </div>
                </div>
            </div>

            <div id="material" class=material></div>

            <div id="preview" class=preview>
                <script src="three/three.js"></script>
                <script id="xesq" class=preview>
                    container = document.getElementById("preview")
                    var scene = new THREE.Scene();
                    scene.background = new THREE.Color(0xf5f5f5);
                    var camera = new THREE.PerspectiveCamera(75, (window.innerWidth-(window.innerWidth*0.45)-12)
                                                                /(window.innerHeight-(window.innerHeight*0.07)), 0.1, 1000);
                    var renderer = new THREE.WebGLRenderer();
                    renderer.setSize(window.innerWidth-(window.innerWidth*0.45)-12, 
                                     window.innerHeight-(window.innerHeight*0.07));

                    container.appendChild(renderer.domElement);
                    var geometry = new THREE.BoxGeometry( 1, 1, 1 );
                    var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
                    var cube = new THREE.Mesh( geometry, material );
                    scene.add( cube );
                    camera.position.z = 5;
                    
                    function changeCubeColor()
                    {
                        console.log("oia");
                        cube.material.color.setHex(Math.random()*0xffffff);
                    }

                    var update = function()
                    {
                        
                    };
            
                    var render = function()
                    {
                        renderer.render(scene, camera);
                    };
            
                    var GameLoop = function()
                    {
                        cube.rotation.x += 0.01;
                        cube.rotation.y += 0.01;
                        //cube.position.x += 0.01;
                        //console.log('updated!');
                        requestAnimationFrame(GameLoop);
                        update();
                        render();
                    }
                    GameLoop();
                </script>
            </div>
            
        </div>
            
    </body>
</html>