<html>
    <head>
        <meta name='viewport' content='width=device-width'/>
        <link rel="stylesheet" href="ui.css">
        <link rel="stylesheet" href="selector.css">
        <title>Pixel Renderer</title>
        <style>
            body {margin: 0;}
            canvas {width: 100%; height: 100%};
            #header{background-color: #2E2E2E; width: 100%; height: 100%}
        </style>
    </head>

    <body>
        <div id="main" class="parent">

            <div id="header" class="header">
                <p class="header-logo">Pixel Renderer</p>
                <input type="file" name="loader" id="loader" class="header-content"onchange="changeCubeColor()"/>
            </div>
            
            <div id="selector" class="selector">
                <div id="info">
                    <button type="button" onclick="createButton()" class="add-character-btn"><b>+</b> Add New Character</button>
                    <div id="character-list" >
                    <script src="three/three.js"></script>
                    <script>
                        var char_names = []
                        char_list = document.getElementById("character-list");
                        var selected_button = null;
                        var cur_txt = null;
                        var cur_exp = null;

                        function selectDiv(index)
                        {
                            console.log(index);
                            char_el = document.getElementById("char_el"+index);
                            txt = document.getElementById("char_el_txt_"+index);
                            exp = document.getElementById("char_el_expand_"+index);
                            
                            if(selected_button != null)
                            {
                                selected_button.className = "button-default";
                                cur_txt.className = "character-txt-default";
                                cur_exp.className = "character-expand-default";
                            }

                            selected_button = char_el;
                            cur_txt = txt;
                            cur_exp = exp;

                            selected_button.className = "button-selected";
                            cur_txt.className = "character-txt-selected";
                            cur_exp.className = "character-expand-selected";
                        }

                        function createButton()
                        {
                            char_names.push("New Character");
                            var i = char_names.length - 1;

                            var char_el = document.createElement("div");
                            char_el.id = "char_el" + i.toString();
                            char_el.className = "button-default";
                            char_el.setAttribute( "onclick", "selectDiv("+i+")" );
                            
                            
                            char_list.appendChild(char_el);
                            
                            var t = document.createTextNode(char_names[i]);
                            var txt = document.createElement("input");
                            txt.id = "char_el_txt_"+i;
                            txt.setAttribute("type", "text");
                            txt.setAttribute("value", "New Character");
                            txt.className = "character-txt-default";
                            txt.readOnly = true;
                            txt.ondblclick = function(){txt.readOnly = false;}
                            txt.onclick = function(){txt.className = "button-selected"}
                            txt.onkeypress = function(e){
                                if (!e) e = window.event;
                                var keyCode = e.keyCode || e.which;
                                if (keyCode == '13'){
                                    txt.readOnly = true;
                                    return;
                                }
                            }
                            
                            var expand = document.createElement("button");
                            expand.className = "character-expand-default";
                            expand.id = "char_el_expand_"+i;
                            exp_txt = document.createTextNode(">");
                            expand.appendChild(exp_txt);
 
                            char_el.appendChild(expand);
                            char_el.appendChild(txt);
                        }

                    </script>
                    </div>
                </div>
            </div>

            <div id="material" class=material></div>

            <div id="preview" class=preview>,
                <div class="slidecontainer">
                    <input type="range" min="0.1" max="1" step="0.01" value="1" class="slider" id="slider" onchange="">
                </div>
                <script src="three/three.js"></script>
                <script id="xesq" class=preview>
                    container = document.getElementById("preview")
                    var scene = new THREE.Scene();
                    scene.background = new THREE.Color(0xf5f5f5);

                    scr_x_size = (window.innerWidth-(window.innerWidth*0.45)-12);
                    scr_y_size = (window.innerHeight-(window.innerHeight*0.07));

                    var camera = new THREE.PerspectiveCamera(75, scr_x_size/scr_y_size, 0.0001, 1000000);
                    var renderer = new THREE.WebGLRenderer({antialias: false});
                    
                    var ratio = 1;
                    renderer.setSize( scr_x_size, scr_y_size);
                    

                    container.appendChild(renderer.domElement);
                    var geometry = new THREE.BoxGeometry( 1, 1, 1 );
                    var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
                    var cube = new THREE.Mesh( geometry, material );
                    scene.add( cube );
                    camera.position.z = 5;
                    

                    var slider = document.getElementById("slider");
                    slider.addEventListener("input", function(){ratio=slider.value; slider.change()});

                    function changeCubeColor()
                    {
                        console.log("oia");
                        cube.material.color.setHex(Math.random()*0xffffff);
                    }

                    var update = function()
                    {
                        renderer.setPixelRatio(ratio);
                    };
            
                    var render = function()
                    {
                        renderer.render(scene, camera);
                    };
            
                    var GameLoop = function()
                    {
                        cube.rotation.x += 0.01;
                        cube.rotation.y += 0.01;
                        requestAnimationFrame(GameLoop);
                        update();
                        render();
                    }
                    GameLoop();
                </script>
            </div>
            
        </div>
            
    </body>
</html>